name: Backup Previous Commit
on:
  workflow_run: 
    workflows: [Get Previous Commits SHAs]
    types: [completed]
    

jobs:
  backup-previous-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Use previous commit SHA
        run: |
          echo "The SHA of the previous commit is: ${{ env.PREVIOUS_SHA }}"
      
      - name: Create backup directory
        run: |
          BACKUP_DIR=/tmp/backup
          mkdir -p $BACKUP_DIR

      - name: Backup previous commit
        uses: actions/checkout@v3
        with:
          repository: ${{ github.repository }}
          ref: ${{ env.PREVIOUS_SHA }}
          path: $BACKUP_DIR

      - name: Check backup
        run: |
          cd $BACKUP_DIR/github-actions  # Accède au dossier cloné dans /tmp/backup
          echo "Backup directory path:"
          pwd
          echo "Backup directory contents:"
          ls -la                        # Liste les fichiers pour vérifier le clonage
          echo "Backup commit SHA:"
          git rev-parse HEAD            # Affiche le SHA du commit pour confirmation
#      - name: Archive backup (optional)
#        run: |
#          cd /path/to/backup/directory
#          tar -czf backup-$(date +'%Y%m%d%H%M%S').tar.gz .
